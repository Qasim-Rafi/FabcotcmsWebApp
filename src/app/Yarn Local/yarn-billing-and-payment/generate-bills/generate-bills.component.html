<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "line-spin-fade" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>

<div class="content-header">
    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-8">
        <h2 class="row wrapper page-header font-weight-light">
          Bill Generation
          <div class="ml-2 descr">
            Generate contract 
            bill for supplier containing commission details.
          </div>
        </h2>
      </div>
  
      <div class="col-sm-12 col-md-6 col-lg-4">
        <ol class="breadcrumb flt-RnL">
          <li class="breadcrumb-item"><a href="#">Billing & Payment</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            Bill Generation
          </li>
        </ol>
      </div>
    </div>
  </div>
  
  <div class="card ibox-content">
    <div class="panel blank-panel">
      
      <div class="panel-heading">
        <div class="row">
          <div class= "col-md-12 text-center">
              <p><strong> Note: </strong>Only those contract will be inluded whose 
                  deliveries were completed and sales invoices generated by supplier.</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 mrg-tsm text-center">
            <button type="button" class="btn btn-primary btn-lg " (click) = "generateBill()">
              <i class="fas fa-play"></i> &nbsp; Generate Bill
            </button>
          </div>
        </div>

        
  
        <div class="row" >
          <div class="col-md-12">
            <div class="row justify-content-end">
              <div class="col-md-8" *ngIf="amount !=null">
                <label for="inputSearch" class="col-sm-3 col-form-label" *ngIf = "amount !=0">Amount: {{amount | number:'2.2-2'}}

              <b *ngIf = "loggedInDepartmentName == 'Yarn Export' || loggedInDepartmentName == 'Fabric Export' || loggedInDepartmentName == 'Yarn Import'">$</b>

                </label>
              </div>
              <div class="col-md-4">

                <div class="form-group row">
                  <label for="inputSearch" class="col-sm-3 col-form-label">Search:</label>
                  <div class="col-sm-9">
                    <input type="text" placeholder="Search..." class="input form-control form-control-sm" (keyup)="search($event)" />
                  </div>
                </div>

                <!-- <div class="input-group col-md-offset-3">
                  <input type="text" placeholder="Search..." class="input form-control w-50"
                   (keyup)="search($event)"/>
                </div> -->

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card shadow">
        <div class="card-body">
      <div class="panel-body">
        <ngx-datatable
      class="bootstrap datatable-row-wrapper" 
      [columns]="columns" 
      [rows]="rows"
         [columnMode]="'force'" 
          [headerHeight]="50"
          [footerHeight]="30"
       [rowHeight]="50"
       [scrollbarH]="true"
       [scrollbarV]="true"
      style="height: 500px;"
            (select)="onSelect($event)"
            
            [selectionType]="SelectionType.checkbox"
            [sorts]="[{ prop: 'id', dir: 'desc' }]"
          >
          <ngx-datatable-column prop="selected" name="Select" [width]="20"   [flexGrow]="0.03"
          [width]="30"
          [headerCheckboxable]="true"
          [checkboxable]="true"
          
          [cellClass]="getCheckboxClass"
          >
            <ng-template let-row="row"    ngx-datatable-cell-template  >
             <!-- <input type="checkbox"> -->
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Contract Date" [width]="80" prop="contractDate" [flexGrow]="0.03"   >
            <ng-template let-row="row" ngx-datatable-cell-template >
         {{row.contractDate}}
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Countract No." [width]="80" prop="autoContractNumber" [flexGrow]="0.05">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
              <button  class="clr"  (click)="navigateEditContract(row)">
              {{row.autoContractNumber}}</button>
             <!-- <button (click)="SaleInvoiceForm()"><i class="far fa-newspaper"></i></button>  -->
            
             <button type="button" class="btn editIconBack px-1 py-1" data-toggle="tooltip" data-placement="top" title=""
                  data-original-title="Sale Invoices" (click)="SaleInvoiceForm(row)"><i
                    class="far fa-newspaper"></i></button>
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Buyer" [width]="80" prop="buyerName" [flexGrow]="0.06">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
        {{row.buyerName}}
            </ng-template>
          </ngx-datatable-column>
          <ngx-datatable-column name="Seller" [width]="80" prop="sellerName" [flexGrow]="0.06">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
        {{row.sellerName}}
            </ng-template>
          </ngx-datatable-column>

          <ngx-datatable-column  *ngIf="loggedInDepartmentName== 'Yarn Export'" name="Contract Owner" [width]="80" prop="contractOwner" [flexGrow]="0.06">
            <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
        {{row.contractOwner}}
            </ng-template>
          </ngx-datatable-column>

  
        </ngx-datatable>
      </div>
        </div>
      </div>
    </div>
    </div>
  <!-- </div> -->


  <!-- <div class="card shadow mb-4">
    <div class="card-body "> 
        <div class="panel-body">
          <kendo-grid
          [kendoGridBinding]="rows"
          kendoGridSelectBy="id"
          [selectedKeys]="mySelection"
          [pageSize]="20"
          [pageable]="true"
          [sortable]="true"
          [reorderable]="true"
          [resizable]="true"
          [height]="800"
          [pageable]="true"
          [filterable]="true"
          
          >
          <ng-template kendoGridToolbarTemplate>
              <input placeholder="Search in all columns..." class="col-md-3 form-control" #newItem kendoTextBox (input)="onFilter(newItem.value)"/>
              <kendo-grid-spacer></kendo-grid-spacer>
          
          </ng-template>
          <kendo-grid-checkbox-column [width]="35" [headerClass]="{'text-center': true}"  
          [class]="{'text-center': true}" [resizable]="false" [columnMenu]="false" [showSelectAll]="true"> 
         
        </kendo-grid-checkbox-column>
          
       
              <kendo-grid-column field="contractDate" title="Contract Date" [width]="120">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                  {{dataItem.contractDate}}
                </ng-template>
                
              </kendo-grid-column>
          
              <kendo-grid-column field="autoContractNumber" title="Countract No#" [width]="120">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                 
                  <button  class="clr"  (click)="navigateEditContract(dataItem)">
                    {{dataItem.autoContractNumber}}</button>
                    <button type="button" class="btn editIconBack px-1 py-1" data-toggle="tooltip" data-placement="top" title=""
                  data-original-title="Sale Invoices" (click)="SaleInvoiceForm(dataItem)"><i
                    class="far fa-newspaper"></i></button>
                </ng-template>
                
              </kendo-grid-column>
              <kendo-grid-column field="buyerName" title="Buyer" [width]="120">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                  {{dataItem.buyerName}}
                </ng-template>
                
              </kendo-grid-column>
         
              <kendo-grid-column field="sellerName" title="Seller" [width]="120">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                  {{dataItem.sellerName}}
                  
                </ng-template>
                
              </kendo-grid-column>
           
          </kendo-grid>
       
        </div>
    </div>
  </div> -->
 