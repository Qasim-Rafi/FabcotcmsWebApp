<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "line-spin-fade" [fullScreen] = "true"><p style="color: white" > Loading... </p>
</ngx-spinner>
<div class="content-header">

  <div class="row">
    <div class="col-sm-12 col-md-6 col-lg-8">
      <h5 class="row wrapper page-header font-weight-light"> Active Contract
        <!-- <h5 class=" wrapper page-header font-weight-light" *ngIf="isFiltred ==true" style="margin-left: 50%;"> Data Filtred</h5> -->
        <!-- <div class="ml-2 descr"> Manage Fabric / Yarn Articles with warp, weft, end, pick,weive & width info </div> -->
      </h5>
      
    </div>

    <div class="col-sm-12 col-md-6 col-lg-4">
      <ol class="breadcrumb flt-RnL">
        <li class="breadcrumb-item"><a href="#">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Active Contracts</li>
      </ol>
    </div>

  </div>
</div>


<div class="card shadow ibox-content">
  <div class=" panel blank-panel">
    <div class="panel-heading">
      
      <div class="row mb-2">
        <div class="col-md-12 text-center">
         
          <!-- <div class="btn-group" role="group">

            <button type="radio" name="exampleRadios" class="btn btn-sm form-check-input" (click)="activeContract();" id="all"
              data-toggle="tooltip" title="" data-original-title="All Contracts"> <i class="fa fa-bullseye fa-fw"></i>
              All &nbsp; <span class="badge badge-pill badge-primary">{{allCount}}</span> 
            </button>

            <button type="radio" name="exampleRadios" class="btn btn-sm form-check-input" (click)="openContract();" id="open"
              data-toggle="tooltip" title="Contract open &amp; in-process"> <i class="far fa-folder-open"></i> Open
              &nbsp; <span class="badge badge-pill badge-primary">{{openCount}}</span> 
            </button>
            
            <button type="radio" name="exampleRadios" class="btn btn-sm form-check-input"  id="close" (click)="closeContract();"
              data-toggle="tooltip" title="Contract working closed &amp; waiting for billing"> <i
                class="fa fa-check fa-fw"></i> Close &nbsp; <span
                class="badge badge-pill badge-primary">{{closedCount}}</span>
              </button>
            <button type="radio" name="exampleRadios" class="btn btn-sm btn-white" (click)="bill_awaitedContract();" id="con-billawaited"
              data-toggle="tooltip" title="Contract ready for billing"> <i class="far fa-clock"></i> Bill Awaited
              &nbsp; <span class="badge badge-pill badge-primary">{{billAwaitedCount}}</span> 
            </button>
            <button type="radio" name="exampleRadios" class="btn btn-sm btn-white" (click)="billedContract();" id="con-billed"
              data-toggle="tooltip" title="Contract bill generated"> <i class="far fa-edit"></i>
              Billed &nbsp; <span class="badge badge-pill badge-primary">{{billedCount}}</span> 
            </button>
            <button type="radio" name="exampleRadios" class="btn btn-sm btn-white" (click)="receivableContract();" id="con-receivable"
              data-toggle="tooltip" title="Some payment received against contract"> <i
                class="far fa-money-bill-alt"></i>
              Receivable &nbsp; <span class="badge badge-pill badge-primary">{{receivableCount}}</span> 
            </button>
            <button type="radio" name="exampleRadios" class="btn btn-sm btn-white" (click)="receivedContract();" id="con-received"
              data-toggle="tooltip" title="All payment received against contract"> <i class="fas fa-dollar-sign"></i>
              Received &nbsp; <span class="badge badge-pill badge-primary">{{receivedCount}}</span> 
            </button>
            <button type="radio" name="exampleRadios" class="btn btn-sm btn-white" (click)="on_HandContract();" id="con-onhold"
              data-toggle="tooltip" title="Contract currently on-hold or deferred"> <i class="far fa-hand-paper"></i>
              On-Hold &nbsp; <span class="badge badge-pill badge-primary">{{onHoldCount}}</span> 
            </button>
          </div> -->
          <!-- *ngIf="isFiltred ==false" -->
          <div class="some"  >
            <input type="radio" name="select" id="option-1" checked>
            <input type="radio" name="select" id="option-2">
            <input type="radio" name="select" id="option-3">
            <input type="radio" name="select" id="option-4">
            <input type="radio" name="select" id="option-5">
            <input type="radio" name="select" id="option-6">
            <input type="radio" name="select" id="option-7">
            <input type="radio" name="select" id="option-8">

              <label for="option-1" class="option option-1" (click)="contractStatus('All');" id="all">
                <div class="dot"></div>
                 <span>All  </span>
                 <span class="badge badge-pill badge-primary ml-2">  {{allCount}}</span>
                 </label>
              <label for="option-2" class="option option-2" (click)="contractStatus('Open');" id="open">
                <div class="mr-2"><i class="far fa-folder-open"></i></div>
                 <span>Open</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{openCount}}</span>
              </label>
              <label for="option-3" class="option option-3" id="close" (click)="contractStatus('Closed');">
                <div class="mr-2"><i class="fa fa-check fa-fw"></i></div>
                 <span>Close</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{closedCount}}</span>
              </label>
              <label for="option-4" class="option option-4" (click)="contractStatus('BillAwaited');" id="con-billawaited">
                <div class="mr-2"><i class="far fa-clock"></i></div>
                 <span>Bill Awaited</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{billAwaitedCount}}</span>
              </label>
              <label for="option-5" class="option option-5" (click)="contractStatus('Billed');" id="con-billed">
                <div class="mr-2"><i class="far fa-edit"></i></div>
                 <span>Billed</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{billedCount}}</span>
              </label>
              <label for="option-6" class="option option-6" (click)="contractStatus('Receivable');" id="con-receivable">
                <div class="mr-2"><i class="far fa-money-bill-alt"></i></div>
                 <span>Receivable</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{receivableCount}}</span>

              </label>
              <label for="option-7" class="option option-7" (click)="contractStatus('Received');" id="con-received">
                <div class="mr-2"><i class="far fa-hand-paper"></i></div>
                 <span>Received</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{receivedCount}}</span>
              </label>
              <label for="option-8" class="option option-8" (click)="contractStatus('OnHold');" id="con-onhold">
                <div class="mr-2"><i class="far fa-hand-paper"></i></div>
                 <span>On-Hold</span>
                 <span class="badge badge-pill badge-primary ml-2">  {{onHoldCount}}</span>
              </label>
           </div>
         
        </div>
      </div>
      
      <!-- <div class="row mb-2">
        <div class="col-md-6 mrg-tsm">
          <button type="button" class="btn btn-primary btn-md">
            <i class="fa fa-filter fa-fw"></i> Advance Filter</button>
        </div>
      </div> -->
     
        <div class="">
      <!-- <div class="row mb-1">
        <div class="col-md-12 mrg-tsm">

      <div class="row">
        <button type="button" class="btn btn-primary btn-sm mr-1 col-md-3"
        (click)="navigateAddContract()"
        >
            <i class="fa fa-plus"></i> Add new Contract
        </button>
        <div class="col-md-4"><label >TotalQuantity : {{totalDisplayPrice.totalQuantity}}</label></div>
        <div class="col-md-4"><label>TotalBalance : {{totalDisplayPrice.totalBalance}}</label></div>
        </div>


   
    </div>
     
      </div> -->

      
      <div class="panel-body">
        
          <div class="text-center" *ngIf="isFiltred ==false"> 
  
          Default 3 Months Data
          </div>
          <div class="text-center" *ngIf="isFiltred ==true"> 
  
            Data Filtered  To {{dateData.ToDate}} From {{dateData.FromDate}}
            </div>
        
        <kendo-grid
        [kendoGridBinding]="rows"
        kendoGridSelectBy="id"
        [pageSize]="20"
        [pageable]="true"
        [sortable]=" {
          allowUnsort: false
        }"
        [reorderable]="true"
        [resizable]="true"
        [height]="450"

        [filterable]="true"
        >
        <ng-template kendoGridToolbarTemplate>
           <button type="button" class="btn btn-primary btn-sm col-md-2"
            (click)="navigateAddContract()"
            >
            <i class="fa fa-plus"></i> Add Contract
          </button>
          
         <h5> <span class="col-md-12 badge badge-success">TotalQuantity : {{totalDisplayPrice.totalQuantity}}</span></h5>
         <h5 > <span class="col-md-12 badge badge-success">TotalBalance : {{totalDisplayPrice.totalBalance}}</span></h5>
           <kendo-grid-spacer></kendo-grid-spacer>
          <input placeholder="Search in all columns..." class="form-control col-md-3 justify-content-end customiconforgrid" #newItem kendoTextBox (input)="onFilter(newItem.value)"/>


      
          
          
              <div class="">
                <div class="">
                  <div class="html5buttons mrg-tsm">
                    <div class="dt-buttons btn-group btn-group-sm">
                      <a class="btn btn-default buttons-excel buttons-html5 bg-white" tabindex="0"
                      (click)="contractExcelFile()"  
                      aria-controls="DataTables_Table_0"><span>Excel</span></a>
                    </div>
                  </div>
            
                </div>
                <button type="button" class="btn btn-primary" *ngIf="isFiltred ==false" (click)="dateFilter()"><i class="fa fa-filter"></i></button>
                <button type="button" class="btn btn-primary" *ngIf="isFiltred ==true" (click)="resetfilter()">Reset</button>
              </div>
              
        </ng-template>
     
        <kendo-grid-checkbox-column [width]="35" [headerClass]="{'text-center': true}"  [class]="{'text-center': true}" [resizable]="false" [columnMenu]="false" [showSelectAll]="true"></kendo-grid-checkbox-column>
        
            <kendo-grid-column field="Action" title="Action" [width]="120" [filterable]="false">
                <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                  <div class="ibox-tools text-center">

                    <span  class="editIconBack1 px-1 py-1 "
                    (click)="navigateEditContract(dataItem)"
                    >
                      <i class="far fa-edit edit  "></i>
                    </span>
    
                    <span type="button" class="editIconBack1 px-1 py-1" (click) = "cloneContract(dataItem)">
                      <i class="far fa-copy"></i>
                    </span>
                    <span  class="editIconBack1 px-1 py-1" 
                   
                    >
                      <i class="fa fa-th edit"></i>
                    </span>
    
                    <span  class="deleteIconBack1 px-1 py-1" 
                    (click)="deleteContract(dataItem)"
                    >
                      <i class="far fa-trash-alt edit"></i>
                    </span>
    
                  </div>
                </ng-template>
            </kendo-grid-column>
        
            <kendo-grid-column field="contractAge" title="Age" [width]="80" [sortable]="true" [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                <span class="badge badge-primary">{{dataItem.contractAge}}</span>
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="autoContractNumber" title="Details" [width]="180" [sortable]="true" [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex"  >
                <p class="text-left">  <strong> {{dataItem.autoContractNumber}} <small *ngIf="loggedInDepartmentName =='Yarn Local Karachi'">({{dataItem.manualContractNumber}})</small></strong> 
                  <span *ngIf = "loggedInDepartmentName == 'Yarn Export'" type="button" placement="right" ngbTooltip="Create Child Contract" class="editIconBack1 px-1 py-1" (click) = "cloneContractChildExportyarn(dataItem)">
                    <i class="far fa-copy"></i>
                  </span> 
                  <br>
                  B: &nbsp;{{dataItem.buyerName}}  <br>
                  S: &nbsp; {{dataItem.sellerName}} </p> 
                  <!-- <p class="text-left" *ngIf = "loggedInDepartmentName == 'Yarn Export'"> <strong> {{dataItem.autoContractNumber}} 
                    <span  class="editIconBack1 px-1 py-1 "
                    (click)="navigateEditContract(dataItem)"
                    >
                      <i class="far fa-edit edit  "></i>
                    </span>
                  </strong>
                   </p> -->
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column *ngIf="loggedInDepartmentName =='Yarn Local Karachi'" field="manualContractNumber" title="MC-No" [width]="80"   [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                
                  {{dataItem.manualContractNumber}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="contractOn" title="Dated" [width]="100"         [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                
                  {{dataItem.contractOn}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="articleName" title="Article/Cons." [width]="120"         [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.articleName}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="price" title="Price" [width]="120"        [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.currencyCode}} {{dataItem.price}} / {{dataItem.uomName}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="quantity" title="Qty" [width]="120"        [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.quantity}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="poNumber" title="PO#" [width]="120"        [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.poNumber}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="scNumber" title="SC#" [width]="120"        [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.scNumber}}
              </ng-template>
              
            </kendo-grid-column>
            <kendo-grid-column field="dispatchQuantity" title="Dispatch(Inv)" [width]="120"        [headerClass]="'customiconforgrid'">
              <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                {{dataItem.dispatchQuantity}}
              </ng-template>
              
            </kendo-grid-column>



         
        </kendo-grid>



      </div>

      
        </div>






    
    </div>


  </div>
</div>

<!-- 
<ag-grid-angular
style="width: 500px; height: 500px;"
class="ag-theme-balham"
[rowData]="rows"
[columnDefs]="columnDefs">
</ag-grid-angular> -->